---
title: Overview
description: Learn about foundry-zksync.
---

::callout{icon="i-heroicons-information-circle-16-solid" color="amber"}
We are actively working on an analogue of the original Foundry book for ZKsync. It will provide in-depth information about ZKsync foundry. Stay tuned!
::

`foundry-zksync` is a specialized fork of [Foundry](https://github.com/foundry-rs/foundry), tailored for ZKsync.

It extends Foundry's capabilities for Ethereum app development to support ZKsync, allowing for the compilation,
deployment, testing, and interaction with smart contracts on ZKsync.
`foundry-zksync` introduces `--zksync` flag, or the use of `vm.zkVm(true)` to target the ZKsync VM.

### Status and Contribution

`foundry-zksync` is currently in its **alpha stage**, indicating ongoing development and potential for future enhancements.
It is open-sourced, and contributions from the developer community are welcome.
For more details and contributions, visit the [GitHub repository](%%zk_git_repo_foundry-zksync%%).

### Changes Made

To use for ZKsync environments, include `--zksync` when running `forge` or `vm.zkVm(true)` in tests. The modifications include:

1. **Compilation:** `solc` and `zksolc` are used for compiling. The resulting bytecodes are combined into `DualCompiledContract`
and managed through `Executor` to `CheatcodeTracer`.
2. **EVM Interactions:**
   - EVM calls are standard except for `address.balance` and `block.timestamp`/`block.number`, which pull data from ZKsync
(ZK-storage and ZK-specific context, respectively).
3. **Transaction Handling:**
   - `CALL` and `CREATE` operations are captured and converted to ZKsync transactions. This process includes fetching
ZKsync-equivalent bytecode, managing account nonces, and marking EOA appropriately to comply with ZKsync requirements.
4. **Execution and State Management:**
   - ZKsync VM processes the transaction and returns state changes, which are applied to `journaled_state`. Results are relayed back.
5. **Logging:**
   - `console.log()` outputs within ZKsync VM are captured and displayed in Foundry.
   - `ZK_DEBUG_RESOLVE_HASHES` and `ZK_DEBUG_SHOW_OUTPUTS` env variable may be set to `true` to display ZKsync VM call logs
with resolved selector hashes (requires Internet connection), and the call outputs, respectively.
6. **Fuzzing**
   - Adds config option `no_zksync_reserved_addresses`. Since ZKsync reserves addresses below 2^16 as system addresses,
a fuzz test would've required a broad `vm.assume` and many `vm.excludeSender` calls to exclude these. This is not only
cumbersome but could also trigger `proptest`'s global `max_global_rejects` failure. When this option is set to `true` the
`proptest` generation itself ensures that no invalid addresses are generated, and thus need not be filtered adding up to the
`max_test_rejects` count.

## ðŸ“Š Features & Limitations

### Features

`Foundry-zksync` offers a set of features designed to work with ZKsync Era, providing a comprehensive toolkit for smart contract deployment and interaction:

- **Fast & flexible compilation pipeline**
  - Automatic Solidity compiler version detection & installation
  - **Incremental compilation & caching**: Only changed files are re-compiled
  - Parallel compilation
  - Non-standard directory structures support (e.g. [Hardhat repos](https://twitter.com/gakonst/status/1461289225337421829))
- **Tests are written in Solidity** (like in DappTools)
- **Fast fuzz testing** with shrinking of inputs & printing of counter-examples
- **Fast remote RPC forking mode**, leveraging Rust's async infrastructure like tokio
- **Flexible debug logging**
  - DappTools-style, using `DsTest`'s emitted logs
  - Hardhat-style, using the popular `console.sol` contract
- **Portable (5-10MB) & easy to install** without requiring Nix or any other package manager
- **Fast CI** with the [Foundry GitHub action](https://github.com/foundry-rs/foundry-toolchain).
- **Smart Contract Deployment**: Easily deploy smart contracts to ZKsync Era mainnet, testnet, or a local test node.
- **Contract Interaction**: Call and send transactions to deployed contracts on ZKsync Era testnet or local test node.
- **Solidity Testing**: Write tests in Solidity, similar to DappTools, for a familiar testing environment.
- **Fuzz Testing**: Benefit from fuzz testing, complete with shrinking of inputs and printing of counter-examples.
- **Remote RPC Forking**: Utilize remote RPC forking mode, leveraging Rust's asynchronous infrastructure like tokio.
- **Flexible Debug Logging**: Choose your debugging style:
  - DappTools-style: Utilize DsTest's emitted logs for debugging.
  - Hardhat-style: Leverage the popular console.sol contract.
- **Configurable Compiler Options**: Tailor compiler settings to your needs, including LLVM optimization modes.

Forge is quite fast at both compiling (leveraging [ethers-solc]) and testing.

### Limitations

While `foundry-zksync` is **alpha stage**, there are some limitations to be aware of:

- **Compile Time**: Some users may experience slower compile times.
- **Compiling Libraries**: Compiling non-inlinable libraries requires deployment and adding to configuration or
the command line with the `--libraries` argument. For more information please refer to [official docs](/build/developer-reference/ethereum-differences/libraries).

    ```toml
    libraries = [
        "src/MyLibrary.sol:MyLibrary:0xfD88CeE74f7D78697775aBDAE53f9Da1559728E4"
    ]
    ```

- **Create2 Address Derivation**: There are differences in Create2 Address derivation compared to Ethereum. [Read the details](/build/developer-reference/ethereum-differences/evm-instructions#create-create2).
- **Contract Verification**: Currently contract verification via the `--verify` flag do not work as expected but will be added shortly.
- **Specific Foundry Features**: Currently features such as `--gas-report`, `--coverage` may not work as intended.
We are actively working on providing support for these feature types.
- **Solc Compatibility**: `zksolc` requires a `solc` binary to be run as a child process. The version/path to use for each can be specified
by the `zksolc` and `solc` options in `foundry.toml`. Not all `solc` versions are supported by all `zksolc` versions, compiling with
a `solc` version higher than the one supported may lead to unexpected errors.
[Read the docs](/zk-stack/components/compiler/toolchain/solidity.html#limitations) about version limitations and check the
[zksolc changelog](https://github.com/matter-labs/era-compiler-solidity/blob/main/CHANGELOG.md) to see the latest supported `solc` version.
- **Windows Compatibility**: Windows is not officially supported yet. The reported issues would be investigated on a best-effort basis.

For the most effective use of our library, we recommend familiarizing yourself with these features and limitations.
